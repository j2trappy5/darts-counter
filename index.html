<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Darts Calculator (2 Players)</title>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; text-align:center; padding:20px; }
    button { margin:4px; padding:10px; font-size:16px; }
    .player { margin:10px 0; font-size:20px; }
    .active { color:#0f0; }
    .finish { font-size:16px; color:#0f0; }
  </style>
</head>
<body>

<h1>Darts Calculator</h1>

<div id="setup">
  <p>Select game:</p>
  <button onclick="startGame(301)">301</button>
  <button onclick="startGame(501)">501</button>
</div>

<div id="game" style="display:none;">
  <div id="p1" class="player active"></div>
  <div id="p2" class="player"></div>
  <div id="finish" class="finish"></div>

  <p>Multiplier:</p>
  <button onclick="setMult(1)">Single</button>
  <button onclick="setMult(2)">Double</button>
  <button onclick="setMult(3)">Treble</button>

  <p>Board:</p>
  <div>
    <script>
      for (let i = 1; i <= 20; i++) {
        document.write(`<button onclick=\"throwDart(${i})\">${i}</button>`);
      }
    </script>
    <br>
    <button onclick="throwBull(25)">25</button>
    <button onclick="throwBull(50)">Bull</button>
  </div>

  <p id="turnInfo">Darts left: 3</p>
</div>

<script>
let scores = [0, 0];
let currentPlayer = 0;
let dartsLeft = 3;
let multiplier = 1;

function startGame(start) {
  scores = [start, start];
  currentPlayer = 0;
  dartsLeft = 3;
  document.getElementById('setup').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  update();
}

function setMult(m) { multiplier = m; }

function throwDart(val) {
  applyScore(val * multiplier);
  multiplier = 1;
}

function throwBull(val) {
  applyScore(val);
}

function applyScore(points) {
  if (dartsLeft === 0) return;

  let newScore = scores[currentPlayer] - points;

  if (newScore < 0 || newScore === 1) {
    endTurn();
    return;
  }

  if (newScore === 0 && points % 2 !== 0) {
    endTurn();
    return;
  }

  scores[currentPlayer] = newScore;
  dartsLeft--;

  if (scores[currentPlayer] === 0) {
    alert(`Player ${currentPlayer + 1} wins!`);
    return;
  }

  if (dartsLeft === 0) endTurn();
  update();
}

function endTurn() {
  dartsLeft = 3;
  currentPlayer = 1 - currentPlayer;
  update();
}

function update() {
  document.getElementById('p1').innerText = `Player 1: ${scores[0]}`;
  document.getElementById('p2').innerText = `Player 2: ${scores[1]}`;

  document.getElementById('p1').classList.toggle('active', currentPlayer === 0);
  document.getElementById('p2').classList.toggle('active', currentPlayer === 1);

  document.getElementById('turnInfo').innerText = `Darts left: ${dartsLeft}`;
  document.getElementById('finish').innerText = getFinish(scores[currentPlayer]);
}

function getFinish(s) {
  if (s > 170) return '';
  if (s === 170) return 'Finish: T20 T20 Bull';
  if (s === 167) return 'Finish: T20 T19 Bull';
  if (s === 160) return 'Finish: T20 T20 D20';
  if (s === 40) return 'Finish: D20';
  if (s === 32) return 'Finish: D16';
  if (s === 24) return 'Finish: D12';
  if (s === 16) return 'Finish: D8';
  if (s === 8) return 'Finish: D4';
  if (s === 4) return 'Finish: D2';
  if (s === 2) return 'Finish: D1';
  return 'Finish possible';
}
</script>

</body>
</html>
